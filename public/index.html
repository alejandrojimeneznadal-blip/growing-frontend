<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Growing Inmobiliario - Centro de Soporte</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-blue: #34BCFF;
            --dark-blue: #166A88;
            --bright-cyan: #41F2F9;
            --light-gray: #E8F6FA;
            --light-blue-bg: rgba(52, 188, 255, 0.08);
            --text-primary: #1A1A1A;
            --text-secondary: #6B7280;
            --border-color: rgba(52, 188, 255, 0.15);
            --white: #FFFFFF;
            --sidebar-width: 320px;
            --success: #10B981;
            --warning: #F59E0B;
            --error: #EF4444;
            --bg-primary: #FFFFFF;
            --bg-secondary: #F9FEFF;
            --shadow-sm: 0 2px 4px rgba(22, 106, 136, 0.05);
            --shadow-md: 0 4px 12px rgba(22, 106, 136, 0.08);
            --shadow-lg: 0 8px 24px rgba(22, 106, 136, 0.12);
        }

        body.dark-mode {
            --text-primary: #F3F4F6;
            --text-secondary: #9CA3AF;
            --border-color: rgba(52, 188, 255, 0.2);
            --white: #111827;
            --light-gray: #1F2937;
            --light-blue-bg: rgba(52, 188, 255, 0.1);
            --bg-primary: #0F172A;
            --bg-secondary: #1E293B;
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.5);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            transition: background-color 0.3s, color 0.3s;
        }

        .icon {
            width: 20px; height: 20px;
            stroke: currentColor; stroke-width: 2;
            stroke-linecap: round; stroke-linejoin: round;
            fill: none;
        }

        /* Splash Screen */
        .splash-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, var(--dark-blue) 0%, var(--primary-blue) 100%);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 10000; opacity: 0; pointer-events: none;
            transition: opacity 0.3s ease;
        }
        .splash-screen.active { opacity: 1; pointer-events: all; }
        .splash-logo { font-size: 4rem; font-weight: 700; color: white; margin-bottom: 2rem; }
        .splash-loader {
            width: 60px; height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top-color: white; border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        .splash-text { color: white; font-size: 1.125rem; margin-top: 2rem; opacity: 0; animation: fadeIn 1s ease 0.5s forwards; }

        @keyframes fadeIn { to { opacity: 1; } }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Auth Styles */
        .auth-container { display: flex; height: 100vh; background: var(--bg-primary); }
        .auth-sidebar {
            width: 40%;
            background: linear-gradient(135deg, var(--dark-blue) 0%, var(--primary-blue) 100%);
            display: flex; align-items: center; justify-content: center;
            padding: 2rem; color: white;
        }
        .auth-content {
            width: 60%; display: flex; align-items: center; justify-content: center;
            padding: 2rem; background: var(--bg-primary);
        }
        .auth-form-container { width: 100%; max-width: 400px; }
        .auth-logo { font-size: 2.5rem; font-weight: 700; color: var(--primary-blue); margin-bottom: 0.5rem; }
        .auth-title { font-size: 1.875rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--text-primary); }
        .auth-subtitle { color: var(--text-secondary); margin-bottom: 2rem; }

        .form-group { margin-bottom: 1.5rem; }
        .form-label { display: block; font-size: 0.875rem; font-weight: 500; margin-bottom: 0.5rem; color: var(--text-primary); }
        .form-input {
            width: 100%; padding: 0.75rem 1rem;
            border: 1px solid var(--border-color); border-radius: 8px;
            font-size: 0.875rem; transition: all 0.2s;
            background-color: var(--bg-secondary); color: var(--text-primary);
        }
        .form-input:focus { outline: none; border-color: var(--primary-blue); box-shadow: 0 0 0 3px rgba(52, 188, 255, 0.1); }

        .btn-primary {
            width: 100%; padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--bright-cyan) 100%);
            color: white; border: none; border-radius: 8px;
            font-size: 0.875rem; font-weight: 600; cursor: pointer;
            transition: all 0.2s;
        }
        .btn-primary:hover { transform: translateY(-1px); box-shadow: var(--shadow-md); }
        .btn-primary:disabled { opacity: 0.7; cursor: not-allowed; transform: none; }

        .auth-toggle { text-align: center; margin-top: 1.5rem; color: var(--text-secondary); font-size: 0.875rem; }
        .auth-toggle a { color: var(--primary-blue); text-decoration: none; font-weight: 600; cursor: pointer; }

        .error-message { color: var(--error); font-size: 0.875rem; margin-top: 0.5rem; display: none; }
        .error-message.show { display: block; }

        /* App Container */
        .app-container { display: none; height: 100vh; background-color: var(--bg-primary); }
        .app-container.active { display: flex; }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width); background-color: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            display: flex; flex-direction: column; height: 100vh;
        }
        .sidebar-header { padding: 1.5rem; border-bottom: 1px solid var(--border-color); background-color: var(--bg-primary); }
        .sidebar-title { font-size: 1.25rem; font-weight: 700; color: var(--text-primary); margin-bottom: 0.25rem; }
        .sidebar-subtitle { font-size: 0.75rem; color: var(--text-secondary); }

        .new-chat-btn {
            margin: 1rem; padding: 0.875rem;
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--bright-cyan) 100%);
            color: white; border: none; border-radius: 8px;
            font-size: 0.875rem; font-weight: 600; cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 0.5rem;
            transition: all 0.2s;
        }
        .new-chat-btn:hover { transform: translateY(-1px); box-shadow: var(--shadow-md); }

        .chat-history { flex: 1; overflow-y: auto; padding: 0.5rem; }
        
        .chat-history-item {
            padding: 0.75rem 1rem; margin-bottom: 0.5rem;
            border-radius: 8px; cursor: pointer;
            transition: all 0.2s; border: 1px solid transparent;
        }
        .chat-history-item:hover { background-color: var(--light-blue-bg); }
        .chat-history-item.active { background-color: var(--light-blue-bg); border-color: var(--primary-blue); }
        .chat-history-title { font-size: 0.875rem; font-weight: 500; color: var(--text-primary); margin-bottom: 0.25rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .chat-history-preview { font-size: 0.75rem; color: var(--text-secondary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .chat-history-meta { display: flex; justify-content: space-between; align-items: center; margin-top: 0.25rem; }
        .chat-history-date { font-size: 0.625rem; color: var(--text-secondary); }
        .chat-history-category { font-size: 0.625rem; padding: 0.125rem 0.5rem; background-color: var(--primary-blue); color: white; border-radius: 4px; }
        
        .chat-history-empty { padding: 2rem 1rem; text-align: center; color: var(--text-secondary); font-size: 0.875rem; }

        .settings-bar {
            padding: 1rem; background-color: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            display: flex; align-items: center; gap: 0.75rem;
            cursor: pointer; transition: background-color 0.2s;
        }
        .settings-bar:hover { background-color: var(--light-blue-bg); }
        .settings-bar-icon {
            width: 36px; height: 36px; background: rgba(255, 255, 255, 0.9);
            border-radius: 8px; display: flex; align-items: center; justify-content: center;
            color: var(--dark-blue);
        }
        .settings-bar-text { flex: 1; font-size: 0.875rem; font-weight: 500; color: var(--text-primary); }

        /* Main Content */
        .main-content { flex: 1; display: flex; flex-direction: column; }

        .main-header {
            height: 70px; padding: 1rem 2rem; background-color: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            display: flex; align-items: center; justify-content: space-between;
        }
        .header-user { display: flex; align-items: center; gap: 0.75rem; }
        .header-avatar {
            width: 48px; height: 48px;
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--bright-cyan) 100%);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            color: white; font-weight: 600;
        }
        .header-name { font-size: 0.875rem; font-weight: 600; color: var(--text-primary); }
        .header-status { font-size: 0.75rem; color: var(--success); display: flex; align-items: center; gap: 0.25rem; }
        .status-dot { width: 6px; height: 6px; background-color: var(--success); border-radius: 50%; }

        .header-actions { display: flex; align-items: center; gap: 0.75rem; }
        .header-btn {
            width: 36px; height: 36px; background-color: var(--bg-secondary);
            border: 1px solid var(--border-color); border-radius: 8px;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: all 0.2s; color: var(--text-secondary);
        }
        .header-btn:hover { background-color: var(--light-blue-bg); color: var(--primary-blue); border-color: var(--primary-blue); }

        /* Chat Area */
        .chat-area { flex: 1; display: flex; flex-direction: column; background-color: var(--bg-primary); }

        .welcome-section {
            flex: 1; display: flex; flex-direction: column;
            align-items: center; justify-content: center; padding: 2rem;
        }
        .welcome-title { font-size: 1.5rem; font-weight: 600; margin-bottom: 1rem; color: var(--text-primary); }
        .welcome-subtitle { color: var(--text-secondary); text-align: center; margin-bottom: 3rem; max-width: 500px; }

        .category-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; max-width: 900px; width: 100%; }
        .category-card {
            background-color: var(--bg-primary); border: 2px solid var(--border-color);
            border-radius: 12px; padding: 2rem; cursor: pointer;
            transition: all 0.3s; text-align: center;
        }
        .category-card:hover { border-color: var(--primary-blue); box-shadow: var(--shadow-lg); transform: translateY(-2px); background-color: var(--light-blue-bg); }
        .category-icon {
            width: 60px; height: 60px;
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--bright-cyan) 100%);
            border-radius: 12px; display: flex; align-items: center; justify-content: center;
            margin: 0 auto 1rem; color: white;
        }
        .category-icon svg { width: 30px; height: 30px; }
        .category-title { font-size: 1rem; font-weight: 600; color: var(--text-primary); margin-bottom: 0.5rem; }
        .category-description { font-size: 0.75rem; color: var(--text-secondary); }

        /* Messages */
        .messages-area { flex: 1; overflow-y: auto; padding: 2rem; display: none; }
        .messages-area.active { display: block; }

        .message { display: flex; gap: 0.75rem; margin-bottom: 1.5rem; }
        .message.user { flex-direction: row-reverse; }
        .message-avatar {
            width: 40px; height: 40px; border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--bright-cyan) 100%);
            display: flex; align-items: center; justify-content: center;
            color: white; flex-shrink: 0;
        }
        .message.user .message-avatar { background: linear-gradient(135deg, var(--dark-blue) 0%, var(--primary-blue) 100%); }
        .message-content {
            max-width: 70%; background-color: var(--bg-secondary);
            padding: 0.75rem 1rem; border-radius: 12px;
            border-bottom-left-radius: 4px; border: 1px solid var(--border-color);
        }
        .message.user .message-content {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--bright-cyan) 100%);
            color: white; border-bottom-left-radius: 12px; border-bottom-right-radius: 4px; border: none;
        }
        .message-text { font-size: 0.875rem; line-height: 1.5; }
        .message-time { font-size: 0.625rem; color: var(--text-secondary); margin-top: 0.25rem; }
        .message.user .message-time { color: rgba(255, 255, 255, 0.8); }

        /* Input Area */
        .input-area { padding: 1.5rem 2rem; background-color: var(--bg-primary); border-top: 1px solid var(--border-color); }
        .input-container { display: flex; gap: 0.75rem; align-items: center; }
        .input-wrapper { flex: 1; position: relative; }
        .message-input {
            width: 100%; padding: 0.875rem 3rem 0.875rem 1rem;
            border: 1px solid var(--border-color); border-radius: 12px;
            font-size: 0.875rem; background-color: var(--bg-secondary);
            color: var(--text-primary); resize: none; outline: none;
            transition: all 0.2s;
        }
        .message-input:focus { background-color: var(--bg-primary); border-color: var(--primary-blue); }
        .message-input:disabled { opacity: 0.6; cursor: not-allowed; }
        .send-btn {
            width: 44px; height: 44px;
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--bright-cyan) 100%);
            border: none; border-radius: 12px; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            color: white; transition: all 0.2s;
        }
        .send-btn:hover { transform: scale(1.05); box-shadow: var(--shadow-md); }
        .send-btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }

        /* Settings Modal */
        .settings-modal {
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0, 0, 0, 0.5); z-index: 1000;
            align-items: center; justify-content: center;
        }
        .settings-modal.active { display: flex; }
        .settings-content {
            background-color: var(--bg-primary); border-radius: 16px;
            width: 90%; max-width: 500px; max-height: 80vh;
            overflow-y: auto; border: 1px solid var(--border-color);
        }
        .settings-header {
            padding: 1.5rem; border-bottom: 1px solid var(--border-color);
            display: flex; align-items: center; justify-content: space-between;
        }
        .settings-title { font-size: 1.25rem; font-weight: 600; color: var(--text-primary); }
        .settings-close {
            width: 32px; height: 32px; background-color: var(--bg-secondary);
            border: 1px solid var(--border-color); border-radius: 8px;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: all 0.2s; color: var(--text-primary);
        }
        .settings-close:hover { background-color: var(--error); color: white; border-color: var(--error); }
        .settings-body { padding: 1.5rem; }
        .settings-section { margin-bottom: 2rem; }
        .settings-section-title { font-size: 0.875rem; font-weight: 600; color: var(--text-primary); margin-bottom: 1rem; }

        .toggle-switch {
            position: relative; width: 48px; height: 24px;
            background-color: var(--border-color); border-radius: 12px;
            cursor: pointer; transition: background-color 0.3s;
        }
        .toggle-switch.active { background-color: var(--primary-blue); }
        .toggle-switch::after {
            content: ''; position: absolute; top: 2px; left: 2px;
            width: 20px; height: 20px; background-color: white;
            border-radius: 50%; transition: transform 0.3s;
        }
        .toggle-switch.active::after { transform: translateX(24px); }

        .settings-option { display: flex; align-items: center; justify-content: space-between; padding: 0.75rem 0; }
        .settings-option-label { font-size: 0.875rem; color: var(--text-primary); }

        /* Mobile */
        .mobile-menu-btn {
            display: none; position: fixed; top: 1rem; left: 1rem;
            z-index: 100000; width: 40px; height: 40px;
            background: var(--bg-secondary); border: 1px solid var(--border-color);
            border-radius: 8px; align-items: center; justify-content: center;
            cursor: pointer; flex-direction: column; gap: 4px; padding: 8px;
        }
        .mobile-menu-btn span { display: block; width: 24px; height: 2px; background: var(--text-primary); border-radius: 2px; }
        .mobile-overlay {
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.5); z-index: 998; opacity: 0;
            transition: opacity 0.3s; pointer-events: none;
        }
        .mobile-overlay.active { display: block; opacity: 1; pointer-events: auto; }

        @media (max-width: 768px) {
            .auth-sidebar { display: none; }
            .auth-content { width: 100%; }
            .sidebar { position: fixed; left: -280px; z-index: 999; transition: left 0.3s ease; }
            .sidebar.active { left: 0; }
            .mobile-menu-btn { display: flex; }
            .category-grid { grid-template-columns: 1fr; }
        }

        .hidden { display: none !important; }

        .typing-indicator { display: flex; gap: 0.25rem; padding: 0.75rem 1rem; background-color: var(--bg-secondary); border-radius: 12px; width: fit-content; }
        .typing-dot { width: 8px; height: 8px; background-color: var(--text-secondary); border-radius: 50%; animation: typing 1.4s infinite; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing { 0%, 60%, 100% { transform: translateY(0); } 30% { transform: translateY(-10px); } }
    </style>
</head>
<body>
    <!-- Splash Screen -->
    <div class="splash-screen" id="splashScreen">
        <div class="splash-logo">Growing</div>
        <div class="splash-loader"></div>
        <div class="splash-text">Preparando tu experiencia...</div>
    </div>

    <!-- Mobile Menu Button -->
    <button id="mobileMenuBtn" class="mobile-menu-btn" onclick="toggleMobileMenu()">
        <span></span><span></span><span></span>
    </button>

    <!-- Mobile Overlay -->
    <div id="mobileOverlay" class="mobile-overlay" onclick="closeMobileMenu()"></div>

    <!-- Login/Register Container -->
    <div class="auth-container" id="authContainer">
        <div class="auth-sidebar">
            <div>
                <h1 style="font-size: 3rem; font-weight: 700; margin-bottom: 1rem;">Growing Inmobiliario</h1>
                <p style="font-size: 1.125rem; opacity: 0.9;">Tu socio estratégico en el mundo inmobiliario</p>
            </div>
        </div>
        <div class="auth-content">
            <div class="auth-form-container">
                <!-- Login Form -->
                <form id="loginForm">
                    <div class="auth-logo">Growing</div>
                    <h2 class="auth-title">Bienvenido de vuelta</h2>
                    <p class="auth-subtitle">Ingresa tus credenciales para continuar</p>
                    
                    <div class="form-group">
                        <label class="form-label">Correo electrónico</label>
                        <input type="email" class="form-input" id="loginEmail" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Contraseña</label>
                        <input type="password" class="form-input" id="loginPassword" required>
                    </div>

                    <div id="loginError" class="error-message"></div>
                    
                    <button type="submit" class="btn-primary" id="loginBtn">Iniciar Sesión</button>
                    
                    <div class="auth-toggle">
                        ¿No tienes cuenta? <a onclick="toggleAuthForm(event)">Regístrate</a>
                    </div>
                </form>

                <!-- Register Form -->
                <form id="registerForm" class="hidden">
                    <div class="auth-logo">Growing</div>
                    <h2 class="auth-title">Crear cuenta</h2>
                    <p class="auth-subtitle">Únete a la comunidad Growing</p>
                    
                    <div class="form-group">
                        <label class="form-label">Nombre completo</label>
                        <input type="text" class="form-input" id="registerName" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Correo electrónico</label>
                        <input type="email" class="form-input" id="registerEmail" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Teléfono</label>
                        <input type="tel" class="form-input" id="registerPhone" placeholder="+34 600 000 000">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Empresa/Inmobiliaria</label>
                        <input type="text" class="form-input" id="registerCompany" placeholder="Nombre de tu empresa">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Contraseña (mínimo 6 caracteres)</label>
                        <input type="password" class="form-input" id="registerPassword" required minlength="6">
                    </div>

                    <div id="registerError" class="error-message"></div>
                    
                    <button type="submit" class="btn-primary" id="registerBtn">Crear Cuenta</button>
                    
                    <div class="auth-toggle">
                        ¿Ya tienes cuenta? <a onclick="toggleAuthForm(event)">Inicia sesión</a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div class="app-container" id="appContainer">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">Growing Inmobiliario</div>
                <div class="sidebar-subtitle">Centro de Soporte</div>
            </div>
            
            <button class="new-chat-btn" onclick="startNewChat()">
                <svg class="icon" viewBox="0 0 24 24" stroke="white" fill="none">
                    <path d="M12 5v14M5 12h14"/>
                </svg>
                <span>Nuevo Chat</span>
            </button>
            
            <div class="chat-history" id="chatHistory">
                <div class="chat-history-empty">Cargando conversaciones...</div>
            </div>
            
            <div class="settings-bar" onclick="openSettings()">
                <div class="settings-bar-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#166A88" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                    </svg>
                </div>
                <div class="settings-bar-text">Ajustes</div>
            </div>
        </aside>

        <main class="main-content">
            <header class="main-header">
                <div class="header-user">
                    <div class="header-avatar">
                        <svg class="icon" viewBox="0 0 24 24" stroke="white" fill="none">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                    </div>
                    <div>
                        <div class="header-name">Asistente de Growing</div>
                        <div class="header-status"><span class="status-dot"></span><span>Disponible</span></div>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="header-btn" title="Buscar">
                        <svg class="icon" viewBox="0 0 24 24" stroke="currentColor" fill="none">
                            <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
                        </svg>
                    </button>
                </div>
            </header>

            <div class="chat-area">
                <div class="welcome-section" id="welcomeSection">
                    <h2 class="welcome-title">¡Bienvenido al Centro de Soporte!</h2>
                    <p class="welcome-subtitle">
                        Estoy aquí para ayudarte a hacer crecer tu inmobiliaria. 
                        Selecciona un tema para comenzar o escribe tu pregunta directamente.
                    </p>
                    
                    <div class="category-grid">
                        <div class="category-card" onclick="selectCategory('comercial')">
                            <div class="category-icon">
                                <svg class="icon" viewBox="0 0 24 24" stroke="white" fill="none">
                                    <rect x="2" y="7" width="20" height="14" rx="2"/>
                                    <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/>
                                </svg>
                            </div>
                            <h3 class="category-title">Comercial</h3>
                            <p class="category-description">Ventas y captación</p>
                        </div>
                        
                        <div class="category-card" onclick="selectCategory('meta-ads')">
                            <div class="category-icon">
                                <svg class="icon" viewBox="0 0 24 24" stroke="white" fill="none">
                                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                                </svg>
                            </div>
                            <h3 class="category-title">Meta Ads</h3>
                            <p class="category-description">Publicidad digital</p>
                        </div>
                        
                        <div class="category-card" onclick="selectCategory('gohighlevel')">
                            <div class="category-icon">
                                <svg class="icon" viewBox="0 0 24 24" stroke="white" fill="none">
                                    <path d="M2 17l10 5 10-5M2 12l10 5 10-5M12 2L2 7l10 5 10-5-10-5z"/>
                                </svg>
                            </div>
                            <h3 class="category-title">GoHighLevel</h3>
                            <p class="category-description">CRM y automatización</p>
                        </div>
                    </div>
                </div>

                <div class="messages-area" id="messagesArea"></div>

                <div class="input-area">
                    <div class="input-container">
                        <div class="input-wrapper">
                            <input type="text" class="message-input" id="messageInput" 
                                   placeholder="Escribe tu mensaje aquí..." onkeypress="handleKeyPress(event)">
                        </div>
                        <button class="send-btn" id="sendBtn" onclick="sendMessage()">
                            <svg class="icon" viewBox="0 0 24 24" stroke="white" fill="none">
                                <line x1="22" y1="2" x2="11" y2="13"/>
                                <polygon points="22 2 15 22 11 13 2 9 22 2"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Settings Modal -->
    <div class="settings-modal" id="settingsModal">
        <div class="settings-content">
            <div class="settings-header">
                <h2 class="settings-title">Ajustes</h2>
                <button class="settings-close" onclick="closeSettings()">
                    <svg class="icon" viewBox="0 0 24 24" stroke="currentColor" fill="none">
                        <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="settings-body">
                <div class="settings-section">
                    <h3 class="settings-section-title">Mi Cuenta</h3>
                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        <div>
                            <label style="display: block; font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 0.25rem;">Nombre</label>
                            <input type="text" class="form-input" id="settingsName" style="width: 100%;">
                        </div>
                        <div>
                            <label style="display: block; font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 0.25rem;">Email</label>
                            <input type="email" class="form-input" id="settingsEmail" style="width: 100%;" disabled>
                        </div>
                    </div>
                </div>
                <div class="settings-section">
                    <h3 class="settings-section-title">Apariencia</h3>
                    <div class="settings-option">
                        <span class="settings-option-label">Modo oscuro</span>
                        <div class="toggle-switch" id="darkModeToggle" onclick="toggleDarkMode()"></div>
                    </div>
                </div>
                <div class="settings-section">
                    <button class="btn-primary" style="width: 100%;" onclick="logout()">Cerrar Sesión</button>
                </div>
                <div class="settings-section" id="adminSection" style="display: none;">
                    <h3 class="settings-section-title">Administración</h3>
                    <button class="btn-primary" style="width: 100%; background: linear-gradient(135deg, var(--dark-blue) 0%, var(--primary-blue) 100%);" onclick="goToAdmin()">
                        Panel de Administrador
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- API Client -->
    <script src="/js/api-client.js"></script>
    
    <script>
        // State
        let currentUser = null;
        let userIsAdmin = false;
        let darkMode = false;
        let currentConversationId = null;
        let isSending = false;

        // Mobile menu
        function toggleMobileMenu() {
            document.getElementById('sidebar').classList.toggle('active');
            document.getElementById('mobileOverlay').classList.toggle('active');
        }
        function closeMobileMenu() {
            document.getElementById('sidebar').classList.remove('active');
            document.getElementById('mobileOverlay').classList.remove('active');
        }

        // Dark mode
        if (localStorage.getItem('darkMode') === 'true') enableDarkMode();
        
        function toggleDarkMode() {
            darkMode ? disableDarkMode() : enableDarkMode();
        }
        function enableDarkMode() {
            document.body.classList.add('dark-mode');
            var toggle = document.getElementById('darkModeToggle');
            if (toggle) toggle.classList.add('active');
            darkMode = true;
            localStorage.setItem('darkMode', 'true');
        }
        function disableDarkMode() {
            document.body.classList.remove('dark-mode');
            var toggle = document.getElementById('darkModeToggle');
            if (toggle) toggle.classList.remove('active');
            darkMode = false;
            localStorage.setItem('darkMode', 'false');
        }

        // Auth
        function toggleAuthForm(e) {
            if (e) e.preventDefault();
            document.getElementById('loginForm').classList.toggle('hidden');
            document.getElementById('registerForm').classList.toggle('hidden');
            document.getElementById('loginError').classList.remove('show');
            document.getElementById('registerError').classList.remove('show');
        }

        function showSplashScreen() {
            document.getElementById('authContainer').style.display = 'none';
            var splash = document.getElementById('splashScreen');
            splash.classList.add('active');
            setTimeout(function() {
                splash.classList.remove('active');
                setTimeout(function() {
                    showApp();
                    loadConversations();
                }, 500);
            }, 2000);
        }

        function showApp() {
            document.getElementById('appContainer').classList.add('active');
        }

        function showError(elementId, message) {
            var el = document.getElementById(elementId);
            el.textContent = message;
            el.classList.add('show');
        }

        function hideError(elementId) {
            document.getElementById(elementId).classList.remove('show');
        }

        // Load conversations from API
        async function loadConversations() {
            if (!window.API) return;
            
            var result = await window.API.loadConversations();
            var container = document.getElementById('chatHistory');
            
            if (result.success && result.conversations && result.conversations.length > 0) {
                container.innerHTML = '';
                result.conversations.forEach(function(conv) {
                    var lastMessage = conv.messages && conv.messages[0] ? conv.messages[0].content : 'Sin mensajes';
                    var date = new Date(conv.updatedAt).toLocaleDateString('es-ES', { day: '2-digit', month: 'short' });
                    
                    var div = document.createElement('div');
                    div.className = 'chat-history-item';
                    div.setAttribute('data-id', conv.id);
                    div.onclick = function() { openConversation(conv.id); };
                    div.innerHTML = 
                        '<div class="chat-history-title">' + escapeHtml(conv.title) + '</div>' +
                        '<div class="chat-history-preview">' + escapeHtml(lastMessage.substring(0, 50)) + '</div>' +
                        '<div class="chat-history-meta">' +
                            '<span class="chat-history-date">' + date + '</span>' +
                            '<span class="chat-history-category">' + conv.category + '</span>' +
                        '</div>';
                    container.appendChild(div);
                });
            } else {
                container.innerHTML = '<div class="chat-history-empty">No hay conversaciones aún. ¡Inicia una nueva!</div>';
            }
        }

        // Open a conversation
        async function openConversation(conversationId) {
            if (window.innerWidth <= 768) closeMobileMenu();
            
            // Mark active in sidebar
            document.querySelectorAll('.chat-history-item').forEach(function(el) {
                el.classList.remove('active');
            });
            var activeItem = document.querySelector('.chat-history-item[data-id="' + conversationId + '"]');
            if (activeItem) activeItem.classList.add('active');
            
            // Load conversation
            var result = await window.API.loadConversation(conversationId);
            
            if (result.success && result.conversation) {
                currentConversationId = conversationId;
                window.API.setCurrentConversationId(conversationId);
                
                // Show messages area
                document.getElementById('welcomeSection').style.display = 'none';
                var messagesArea = document.getElementById('messagesArea');
                messagesArea.classList.add('active');
                messagesArea.innerHTML = '';
                
                // Render messages
                if (result.conversation.messages) {
                    result.conversation.messages.forEach(function(msg) {
                        addMessageToUI(msg.content, msg.sender === 'user', msg.createdAt);
                    });
                }
            }
        }

        // Add message to UI
        function addMessageToUI(text, isUser, timestamp) {
            var messagesArea = document.getElementById('messagesArea');
            var div = document.createElement('div');
            div.className = 'message' + (isUser ? ' user' : '');
            
            var time;
            if (timestamp) {
                time = new Date(timestamp).toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
            } else {
                time = new Date().toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
            }
            
            var icon = isUser ? 
                '<svg class="icon" viewBox="0 0 24 24" stroke="white" fill="none"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>' :
                '<svg class="icon" viewBox="0 0 24 24" stroke="white" fill="none"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg>';
            
            div.innerHTML = '<div class="message-avatar">' + icon + '</div><div class="message-content"><div class="message-text">' + escapeHtml(text) + '</div><div class="message-time">' + time + '</div></div>';
            messagesArea.appendChild(div);
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }

        function escapeHtml(text) {
            var div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('App initializing...');

            // Check if already logged in
            if (window.API && window.API.isAuthenticated()) {
                currentUser = window.API.getCurrentUser();
                if (currentUser) {
                    userIsAdmin = currentUser.role === 'admin';
                    document.getElementById('authContainer').style.display = 'none';
                    showApp();
                    loadConversations();
                    if (userIsAdmin) document.getElementById('adminSection').style.display = 'block';
                }
            }

            // Login form
            document.getElementById('loginForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                hideError('loginError');
                
                var email = document.getElementById('loginEmail').value.trim();
                var password = document.getElementById('loginPassword').value;
                var btn = document.getElementById('loginBtn');
                
                if (!email || !password) {
                    showError('loginError', 'Por favor completa todos los campos');
                    return;
                }

                btn.disabled = true;
                btn.textContent = 'Iniciando sesión...';

                try {
                    if (window.API && window.API.login) {
                        var result = await window.API.login(email, password);
                        console.log('Login result:', result);
                        
                        if (result.success) {
                            currentUser = result.user;
                            userIsAdmin = currentUser && currentUser.role === 'admin';
                            if (userIsAdmin) document.getElementById('adminSection').style.display = 'block';
                            showSplashScreen();
                        } else {
                            showError('loginError', result.error || 'Credenciales inválidas');
                        }
                    } else {
                        showError('loginError', 'API no disponible');
                    }
                } catch (err) {
                    console.error('Login error:', err);
                    showError('loginError', 'Error de conexión');
                }

                btn.disabled = false;
                btn.textContent = 'Iniciar Sesión';
            });

            // Register form
            document.getElementById('registerForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                hideError('registerError');
                
                var name = document.getElementById('registerName').value.trim();
                var email = document.getElementById('registerEmail').value.trim();
                var phone = document.getElementById('registerPhone').value.trim();
                var company = document.getElementById('registerCompany').value.trim();
                var password = document.getElementById('registerPassword').value;
                var btn = document.getElementById('registerBtn');

                if (!name || !email || !password) {
                    showError('registerError', 'Por favor completa los campos obligatorios');
                    return;
                }

                if (password.length < 6) {
                    showError('registerError', 'La contraseña debe tener al menos 6 caracteres');
                    return;
                }

                btn.disabled = true;
                btn.textContent = 'Creando cuenta...';

                try {
                    if (window.API && window.API.register) {
                        var userData = {
                            name: name,
                            email: email,
                            password: password,
                            phone: phone || '',
                            company: company || ''
                        };
                        
                        var result = await window.API.register(userData);
                        
                        if (result.success) {
                            currentUser = result.user;
                            userIsAdmin = false;
                            showSplashScreen();
                        } else {
                            showError('registerError', result.error || 'Error al crear cuenta');
                        }
                    } else {
                        showError('registerError', 'API no disponible');
                    }
                } catch (err) {
                    console.error('Register error:', err);
                    showError('registerError', 'Error de conexión');
                }

                btn.disabled = false;
                btn.textContent = 'Crear Cuenta';
            });

            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') closeSettings();
            });

            console.log('App ready!');
        });

        // Chat functions
        function startNewChat() {
            if (window.innerWidth <= 768) closeMobileMenu();
            
            currentConversationId = null;
            window.API.setCurrentConversationId(null);
            
            document.querySelectorAll('.chat-history-item').forEach(function(el) {
                el.classList.remove('active');
            });
            
            document.getElementById('welcomeSection').style.display = 'flex';
            document.getElementById('messagesArea').classList.remove('active');
            document.getElementById('messagesArea').innerHTML = '';
        }

        function selectCategory(category) {
            if (window.innerWidth <= 768) closeMobileMenu();
            
            currentConversationId = null;
            
            document.getElementById('welcomeSection').style.display = 'none';
            document.getElementById('messagesArea').classList.add('active');
            document.getElementById('messagesArea').innerHTML = '';
            
            var welcomeMessages = {
                'comercial': '¡Hola! Soy tu asistente comercial. ¿En qué puedo ayudarte con ventas o captación de propiedades?',
                'meta-ads': '¡Hola! Soy tu experto en Meta Ads. ¿Tienes dudas sobre campañas publicitarias?',
                'gohighlevel': '¡Hola! Estoy aquí para ayudarte con GoHighLevel. ¿Qué necesitas configurar o automatizar?'
            };
            
            addMessageToUI(welcomeMessages[category] || '¿En qué puedo ayudarte?', false);
        }

        async function sendMessage() {
            if (isSending) return;
            
            var input = document.getElementById('messageInput');
            var message = input.value.trim();
            
            if (!message) return;
            
            isSending = true;
            input.disabled = true;
            document.getElementById('sendBtn').disabled = true;
            
            // Show user message
            addMessageToUI(message, true);
            input.value = '';
            
            // Show welcome section as chat if needed
            if (document.getElementById('welcomeSection').style.display !== 'none') {
                document.getElementById('welcomeSection').style.display = 'none';
                document.getElementById('messagesArea').classList.add('active');
            }
            
            // Show typing indicator
            showTypingIndicator();
            
            try {
                var result = await window.API.sendMessage(message, currentConversationId);
                
                hideTypingIndicator();
                
                if (result.success) {
                    // Update conversation ID if new
                    if (!currentConversationId && result.conversation) {
                        currentConversationId = result.conversation.id;
                        window.API.setCurrentConversationId(currentConversationId);
                        loadConversations(); // Refresh sidebar
                    }
                    
                    // Show bot response
                    if (result.botMessage) {
                        addMessageToUI(result.botMessage.content, false);
                    }
                } else {
                    addMessageToUI('Lo siento, hubo un error. Por favor intenta de nuevo.', false);
                }
            } catch (err) {
                hideTypingIndicator();
                console.error('Send error:', err);
                addMessageToUI('Error de conexión. Por favor intenta de nuevo.', false);
            }
            
            isSending = false;
            input.disabled = false;
            document.getElementById('sendBtn').disabled = false;
            input.focus();
        }

        function showTypingIndicator() {
            var messagesArea = document.getElementById('messagesArea');
            var div = document.createElement('div');
            div.className = 'message';
            div.id = 'typingIndicator';
            div.innerHTML = '<div class="message-avatar"><svg class="icon" viewBox="0 0 24 24" stroke="white" fill="none"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg></div><div class="typing-indicator"><span class="typing-dot"></span><span class="typing-dot"></span><span class="typing-dot"></span></div>';
            messagesArea.appendChild(div);
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }

        function hideTypingIndicator() {
            var el = document.getElementById('typingIndicator');
            if (el) el.remove();
        }

        function handleKeyPress(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        }

        // Settings
        function openSettings() {
            var user = window.API ? window.API.getCurrentUser() : currentUser;
            if (user) {
                document.getElementById('settingsName').value = user.name || '';
                document.getElementById('settingsEmail').value = user.email || '';
            }
            document.getElementById('settingsModal').classList.add('active');
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.remove('active');
        }

        function logout() {
            if (window.API) window.API.logout();
            currentUser = null;
            userIsAdmin = false;
            currentConversationId = null;
            document.getElementById('adminSection').style.display = 'none';
            document.getElementById('appContainer').classList.remove('active');
            document.getElementById('authContainer').style.display = 'flex';
            document.getElementById('loginEmail').value = '';
            document.getElementById('loginPassword').value = '';
            closeSettings();
        }

        function goToAdmin() {
            if (userIsAdmin) {
                alert('Panel de administración en desarrollo');
                closeSettings();
            }
        }
    </script>
</body>
</html>
